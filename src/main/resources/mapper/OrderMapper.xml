<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.midnear.midnearshopping.mapper.order.OrderMapper">

    <!-- 주문 정보 조회 -->
    <select id="getOrdersByUserId">
        SELECT *
        FROM orders o
        WHERE user_id = #{userId}
        ORDER BY
        <choose>
            <when test="sort == 'latest'">
                o.order_date DESC
            </when>
            <when test="sort == 'oldest'">
                o.order_date ASC
            </when>
            <otherwise>
                o.order_date DESC
            </otherwise>
        </choose>
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <select id="getOrderById" parameterType="long" resultType="com.midnear.midnearshopping.domain.vo.order.OrdersVO">
        SELECT * FROM orders WHERE order_id = #{orderId}
    </select>


    <!-- 주문 정보 전체 조회 -->
    <select id="getAllOrders">
        SELECT * FROM orders
    </select>

    <!-- 주문 추가 -->
    <insert id="insertOrder" useGeneratedKeys="true" keyProperty="orderId" >
        INSERT INTO orders (
            order_name, order_contact, order_email,
             order_date, recipient_name, postal_code,
            address, detailed_address, order_number, user_id, all_payment
        ) VALUES (
                     #{orderName}, #{orderContact}, #{orderEmail},
                      #{orderDate}, #{recipientName}, #{postalCode},
                     #{address}, #{detailedAddress},  #{orderNumber}, #{userId},
                      #{allPayment}
                 )
    </insert>

    <!-- 주문 정보 수정 -->
    <update id="updateOrder">
        UPDATE orders SET
                          order_name = #{orderName},
                          order_contact = #{orderContact},
                          order_email = #{orderEmail},
                          total_order_quantity = #{quantity},
                          total_payment_amount = #{totalPaymentAmount},
                          order_date = #{orderDate},
                          recipient_name = #{recipientName},
                          postal_code = #{postalCode},
                          address = #{address},
                          detailed_address = #{detailedAddress},
                          point_usage = #{pointUsage},
                          order_number = #{orderNumber},
                          user_id = #{userId},
                          delivery_id = #{deliveryId},
                          all_payment = #{allPayment}
        WHERE order_id = #{orderId}
    </update>

    <!-- 주문 삭제 -->
    <delete id="deleteOrderById">
        DELETE FROM orders WHERE order_id = #{orderId}
    </delete>

</mapper>
