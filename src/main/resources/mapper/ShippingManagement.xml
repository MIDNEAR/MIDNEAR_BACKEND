<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.midnear.midnearshopping.mapper.productManagement.ShippingManagementMapper">
    <update id="updateShipping">
        update delivery_charge
        set
            basic_delivery_cost = #{basicDeliveryCost},
            free_delivery_condition = #{freeDeliveryCondition},
            jeju_delivery_cost = #{jejuDeliveryCost},
            island_mountain_delivery_cost = #{islandMountainDeliveryCost}
        where charge_id = 1
    </update>

    <!--일반 배송정보 업데이트 -->
    <select id="getInTransitOrders">
        SELECT di.delivery_id,
               cm.carrier_code,
               di.invoice_number
        FROM delivery_info di
            inner join carrier_mapping  cm on  di.carrier_id = cm.carrier_id
        WHERE di.tracking_delivery = '배송중'
    </select>

    <update id="updateTrackingStatus">
        UPDATE delivery_info
        SET tracking_delivery = '배송완료',
            delivery_complete_date = current_timestamp
        WHERE delivery_id = #{deliveryId}
    </update>

    <!--반품 배송정보 업데이트 -->
    <select id="getReturnOrder">
        SELECT rd.delivery_id,
               cm.carrier_code,
               rd.invoice_number
        FROM return_delivery rd
                 inner join carrier_mapping  cm on  rd.carrier_id = cm.carrier_id
        WHERE rd.return_delivery_status = '수거완료'
    </select>

    <update id="updateReturnStatus">
        UPDATE return_delivery
        SET return_delivery_status = '환불대기중',
        WHERE return_delivery_id = #{returnDeliveryId}
    </update>

</mapper>