<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.midnear.midnearshopping.mapper.productManagement.ReturnMapper">
    <!-- 환불상품 최신순 조회 -->
    <select id="selectAll">
        select
            r.return_id,
            o.order_number,
            di.tracking_delivery,
            r.return_status,
            rd.return_delivery_status,
            p.payment_date,
            r.return_request_date,
            r.return_reason,
            rd.collection_complete_date,
            rd.delivery_fee,
            rd.payment_status,
            op.product_name,
            op.color,
            op.size,
            op.quantity,
            op.product_price,
            op.coupon_discount,
            op.point_discount,
            o.all_payment,
            op.delivery_charge,
            o.order_name,
            u.id,
            o.recipient_name,
            di.courier,
            di.invoice_number,
            rd.courier,
            rd.invoice_number,
            o.order_contact,
            o.recipient_contact
        from order_products op
                 inner join returns r on r.order_product_id = op.order_product_id
                 inner join orders o on op.order_id = o.order_id
                 left join return_delivery rd on rd.return_id = r.return_id
                 left join delivery_info di on op.delivery_id = di.delivery_id
                 left join payments p ON o.order_id = p.order_id
                 left join users u on o.user_id = u.user_id
        where  r.return_id is not null
        order by r.return_id
            LIMIT #{pageSize} OFFSET #{offset}

    </select>

    <select id="count">
        select count(*)
        from order_products op
                 inner join returns r on r.order_product_id = op.order_product_id
                 inner join orders o on op.order_id = o.order_id
                 left join return_delivery rd on rd.return_id = r.return_id
                 left join delivery_info di on op.delivery_id = di.delivery_id
                 left join payments p ON o.order_id = p.order_id
                 left join users u on o.user_id = u.user_id
        where  r.return_id is not null
    </select>


</mapper>